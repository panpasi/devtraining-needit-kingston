<?xml version="1.0" encoding="UTF-8"?>
<record_update sys_domain="global" table="sys_script_client">
    <sys_script_client action="INSERT_OR_UPDATE">
        <active>true</active>
        <applies_extended>false</applies_extended>
        <condition/>
        <description>Use the GetEmail Address Script Include to retrieve the Requested for's email address from the database when the Requested for value changes</description>
        <field>u_requested_for</field>
        <global>true</global>
        <messages/>
        <name>NeedIt Populate Email Field</name>
        <order/>
        <script><![CDATA[function onChange(control, oldValue, newValue, isLoading, isTemplate) {
	//jslog('oldValue: ' + oldValue);
	//jslog('newValue: ' + newValue);
	
	// This will cause another potential issue, e.g. the scenario below:
	// The original value is A, changed it to B, and then changed it back to A, the email will not be changed back to A's email, it will keep to use B's email, because newValue === oldValue as per this scenario
	if ( (isLoading && !g_form.isNewRecord()) || newValue === ''  || newValue === oldValue) {
		return;
	}
	
	// Instantiate the GetEmailAddress Script Include
	var getEmailAddress = new GlideAjax('GetEmailAddress');
	// Specify the getEmail method
	getEmailAddress.addParam('sysparm_name','getEmail');
	// Pass the Request for sys_id
	getEmailAddress.addParam('sysparm_userID',g_form.getValue('u_requested_for'));
	// Send the request to server
	getEmailAddress.getXML(populateEmailField);
	
	// When the response is back from the server
	function populateEmailField(response){
		// Extract the eamil address from the response
		// Clear any value from the eamil field and set new value meanwhile
		var emailFromScriptInclude = response.responseXML.documentElement.getAttribute('answer');
		g_form.clearValue('u_requested_for_email');
		g_form.setValue('u_requested_for_email',emailFromScriptInclude);
	}
	
}]]></script>
        <sys_class_name>sys_script_client</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2017-12-13 02:50:09</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>a24976bcdb074300f1dc771c8c9619af</sys_id>
        <sys_mod_count>6</sys_mod_count>
        <sys_name>NeedIt Populate Email Field</sys_name>
        <sys_overrides/>
        <sys_package display_value="NeedIt" source="x_58872_needit">6ead8e780f603200cd674f8ce1050ed1</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="NeedIt">6ead8e780f603200cd674f8ce1050ed1</sys_scope>
        <sys_update_name>sys_script_client_a24976bcdb074300f1dc771c8c9619af</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2017-12-13 06:37:22</sys_updated_on>
        <table>x_58872_needit_needit</table>
        <type>onChange</type>
        <ui_type>0</ui_type>
        <view/>
    </sys_script_client>
</record_update>
